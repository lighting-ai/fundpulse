## 自选页面改造

我发现一个问题，有些基金没办法获取实时估值，所以在调用接口获取净值和估值时会返回空

```bash
https://fundgz.1234567.com.cn/js/008163.js?rt=1770138510967

--> response
jsonpgz();

```

所以可能要对自选页面基金做一下分类，针对支持实时估值的，在盘中才去查这个接口，不支持的就不查了只显示净值

所以要对基金数据做下分类，自选基金列表增加基金类型字段，但是之前的版本好像没有存储类型字段，可能要做一个兼容，针对没有类型的字段就显示--，如果该列包含--类型的，表头就显示一个刷新按钮，悬浮提示刷新基金类型

然后可能要支持两种展示方式

一种是全部列表展示，一种是按照分类选项卡展示，在整体表格右上方支持切换两种模式互相切换，当升级后，用户看到的肯定是列表的，点击切换，如果存在--类型的就提示用户先更新基金类型在切换，不存在--类型的就直接切换

关于基金类型参考下表，目前支持股票型，混合型，指数型调用 `https://fundgz.1234567.com.cn/js/008163.js?rt=1770138510967` 这个 API 获取实时估算。但是指数型里好像 ETF联接的就不支持，比如 `南方红利低波50ETF联接A(008163)` 也排除指数型名字里带 ETF的

关于类型字段，就取搜索结果数据中的FTYPE字段，搜索接口响应实例如下

```json
jQuery1770138172404_82wgnjnws({
    "ErrCode": 0,
    "ErrMsg": "fromes",
    "Datas": [{
        "_id": "018957",
        "CODE": "018957",
        "NAME": "中航机遇领航混合发起C",
        "JP": "ZHJYLHHHFQC",
        "CATEGORY": 700,
        "CATEGORYDESC": "基金",
        "STOCKMARKET": null,
        "BACKCODE": "018957",
        "MatchCount": 1,
        "FundBaseInfo": {
            "_id": "018957",
            "FCODE": "018957",
            "RSFUNDTYPE": "002",
            "SHORTNAME": "中航机遇领航混合发起C",
            "JJGSID": "80508391",
            "JJGS": "中航基金",
            "JJJLID": "30368716",
            "JJJL": "韩浩",
            "FUNDTYPE": "002",
            "ISBUY": "1",
            "MINSG": 10.0,
            "JJGSBID": "",
            "OTHERNAME": "",
            "FTYPE": "混合型-偏股",
            "DWJZ": 3.7138,
            "FSRQ": "2026-02-03",
            "NAVURL": "http://fund.eastmoney.com/HH_jzzzl.html"
        },
        "StockHolder": null,
        "ZTJJInfo": [{
            "TTYPE": "BK000176",
            "TTYPENAME": "通信设备"
        }, {
            "TTYPE": "BK000055",
            "TTYPENAME": "元件"
        }],
        "SEARCHWEIGHT": 0.0,
        "NEWTEXCH": ""
    }]
})

```

我记得我们写了个FundDataManager 计算盘中估值，盘后 净值的函数，好像估值就是调用 https://fundgz.1234567.com.cn/js/{code}.js?rt=1770138510967 这个接口吧，如果是不支持的类型就没有盘中估值了，直接用pingzhongdata 中获取的净值即可。还有好像详情显示的净值也有同样的逻辑一起处理了，应该是统一修改FundDataManager就可以了，调用的地方都能生效

## 基金类型对照表

**表格**复制

| 基金类型       | FUNDTYPE | 实时估值        | 原因                           |
| :------------- | :------- | :-------------- | :----------------------------- |
| **股票型基金** | 001      | ✅**可以**      | 高比例持仓股票，有公开持仓     |
| **混合型基金** | 002      | ✅**可以**      | 股票仓位通常 >60%，可估算      |
| **指数型基金** | 003      | ✅**可以**      | 复制指数成分股，持仓透明       |
| **债券型基金** | 004      | ❌**不行**      | 债券市场无实时交易价格（场外） |
| **货币型基金** | 005      | ❌**不行**      | 采用摊余成本法，市值稳定       |
| **QDII 基金**  | 006      | ⚠️**部分/滞后** | 海外市场时差，T+1 甚至 T+2     |
| **FOF 基金**   | 007      | ❌**不行**      | 投资基金而非股票，双重滞后     |

---

实时估值的核心原理

**实时估值 = 基金持仓股票实时价格 × 持仓权重**

所以前提是：**基金必须主要持有可在二级市场实时交易的股票**

## cursor问题

### phase1

1. 使用原始字段 ftype 保存 FTYPE, fundType 保存 FUNDTYPE ，历史数据就是空字符串了
2. 排除所有 ETF类型的，即名字包含 ETF的
3. 是批量刷新，可能要并发调用搜索接口获取
4. 分类方式：按照 ftype字段，但是如果 ftype 带有-就取分割后的第一个元素就好了
5. 仅从纯列表切换到分类展示列表且存在--类型才提示
6. 做下兜底，如果我们规定的类型也遇到请求了https://fundgz.1234567.com.cn/js/008163.js?rt=1770138510967 返回空了，就跳过实时估算

### phase2

1. 自选 pc端整个页面太宽了，占整个屏幕太多了，整体缩小一点，左右缩小一点，感觉跟首页的整体宽度保持一致
2. 自选基金列表不要显示 AI列，按钮都在操作列里，AI标识按钮放到最后
3. 在列表模式的时候应该是显示切换标记-分类模式，在分类模式下 显示切换标记-列表模式
4. 我试了下切换，点击确定刷新没有类型的基金数据后看，没有轮询的去请求所有--的基金数据，只请求了一条，我有5 条，且请求的结果没有更到类型字段中
